package aa.bb.exploiterjson;

import androidx.appcompat.app.AppCompatActivity;

import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Spinner;
import android.widget.Switch;
import android.widget.TextView;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;

public class MainActivity2 extends AppCompatActivity {
Spinner sp;
TextView txtNom;
Switch swPara;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main2);
sp=findViewById(R.id.spQuartiers);
txtNom=findViewById(R.id.txtNom);
swPara =findViewById(R.id.swPara);
try {

    String data ="[{\"quartier\":\"Youssoufia\",\"nom\":\"Pharmacie Al anwar\",\"para\":true},{\"quartier\":\"Riad\",\"nom\":\"Pharmacie Annasr\",\"para\":true},{\"quartier\":\"Yaakoub Al Manssour\",\"nom\":\"Pharmacie Al Abtal\",\"para\":false}]";

    //on veut afficher la liste des quarties dans un spinner
    JSONArray ja = new JSONArray(data);
    ArrayList<String> AL = new ArrayList<>();
    for (int i =0;i<ja.length();i++)
    {
        AL.add(ja.getJSONObject(i).getString("quartier"));
    }
    ArrayAdapter<String> AA = new ArrayAdapter<>(MainActivity2.this, android.R.layout.simple_list_item_1,AL);
    sp.setAdapter(AA);
    sp.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {
        @Override
        public void onItemSelected(AdapterView<?> adapterView, View view, int i, long l) {
//vidage des eones
            txtNom.setText("");
            swPara.setChecked(false);
            //  Log.i("infos",sp.getSelectedItem().toString() );
            String quart = sp.getSelectedItem().toString();
            try {
                for (int j = 0; j < ja.length(); j++) {
                    JSONObject jo= ja.getJSONObject(i);

                   if (jo.getString("quartier").equals(quart)) {
                       txtNom.setText(jo.getString("nom"));
                       swPara.setChecked(jo.getBoolean("para"));
                       return;


                    }
                }


        } catch( JSONException e)

        {
            throw new RuntimeException(e);
        }
    }

        @Override
        public void onNothingSelected(AdapterView<?> adapterView) {

        }
    });



}
catch (Exception ex)
{
    Log.e("infos",ex.getMessage());
}


    }
}